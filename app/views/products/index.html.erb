<p id="notice"><%= notice %></p>

<script>

function create_pricelist() {
    window.open("/products/pricelist?date=" + $('#valid_until_field').val() + "&currency=" + $('#currency_select').val(), '_blank')
}

</script>

<h1>Products</h1>

<%= button_to 'New Product', new_product_path, :method => "get" %>

<p></p>

Valid Until <input type="text" value="<%=Date.current.next_month.next_month.next_month.end_of_month.strftime("%-d %B %Y")%>" id="valid_until_field"/>
Currency <select id="currency_select"><option value="GBP">GBP</option><option value="USD">USD</option></select>
<input type="button" value="Create Price List" onClick="javascript:create_pricelist()"/>

<p></p>

<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>SKU</th>    
      <th>Qty</th>
      <th>Production Cost Â£</th>
      <th colspan="3"></th>
    </tr>
  </thead>

  <tbody>
    <% products = Product.all.order(name: :asc)
    products.each do |product| 
        style_class = ""
        if (product.qty <= product.stock_warning_level)
            style_class = "warning"
        end%>
      <tr class="<%=style_class%>">
        <td><%= link_to product.name, edit_product_path(product) %></td>
        <td><%= product.sku %></td>  
        <td><%= product.qty %></td>
        <td><%= product.production_cost.round(2) %></td>
        <td><%= link_to 'Delete', product, method: :delete, data: { confirm: 'Are you sure?' } %></td>
      </tr>
    <% end %>
  </tbody>
</table>

<br>


